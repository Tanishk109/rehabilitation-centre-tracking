{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\n\n// Default connection string if not in env (for scripts)\nconst defaultUri = 'mongodb+srv://necks:fdLaWizvRAmTYvdG@cluster0.ebmc6q3.mongodb.net/rehabilitation-centre-tracking?retryWrites=true&w=majority&appName=Cluster0'\n\nif (!process.env.MONGODB_URI && typeof window === 'undefined') {\n  // Only set default in server-side context\n  process.env.MONGODB_URI = defaultUri\n}\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Please add your Mongo URI to .env.local')\n}\n\nconst uri: string = process.env.MONGODB_URI\nconst options = {}\n\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === 'development') {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>\n  }\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    globalWithMongo._mongoClientPromise = client.connect()\n  }\n  clientPromise = globalWithMongo._mongoClientPromise\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\nexport default clientPromise\n\nexport async function getDatabase(): Promise<Db> {\n  const client = await clientPromise\n  return client.db('rehabilitation-centre-tracking')\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,wDAAwD;AACxD,MAAM,aAAa;AAEnB,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,IAAI,kDAAkB,aAAa;IAC7D,0CAA0C;IAC1C,QAAQ,GAAG,CAAC,WAAW,GAAG;AAC5B;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAc,QAAQ,GAAG,CAAC,WAAW;AAC3C,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAQe;AAER,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACnB"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/app/api/queries/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getDatabase } from '@/lib/mongodb'\nimport { Query } from '@/lib/models'\n\n// GET - Fetch all queries (with optional filtering)\nexport async function GET(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const queriesCollection = db.collection<Query>('queries')\n    \n    const { searchParams } = new URL(request.url)\n    const role = searchParams.get('role')\n    const centreId = searchParams.get('centreId')\n    const status = searchParams.get('status')\n    const priority = searchParams.get('priority')\n\n    let query: any = {}\n\n    // Filter by centreId if centre_admin\n    if (role === 'centre_admin' && centreId) {\n      query.centreId = centreId\n    }\n\n    // Filter by status\n    if (status) {\n      query.status = status\n    }\n\n    // Filter by priority\n    if (priority) {\n      query.priority = priority\n    }\n\n    const queries = await queriesCollection.find(query).sort({ createdAt: -1 }).toArray()\n    \n    return NextResponse.json({ success: true, data: queries })\n  } catch (error) {\n    console.error('Error fetching queries:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch queries' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST - Create a new query\nexport async function POST(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const queriesCollection = db.collection<Query>('queries')\n    const centresCollection = db.collection('centres')\n    \n    const body = await request.json()\n    const { role, centreId: userCentreId, createdBy } = body\n\n    // Centre admin can only create queries for their centre\n    if (role === 'centre_admin') {\n      body.centreId = userCentreId\n    }\n\n    // Get centre name\n    const centre = await centresCollection.findOne({ id: body.centreId })\n    body.centreName = centre?.name || ''\n\n    // Generate ID if not provided\n    if (!body.id) {\n      const count = await queriesCollection.countDocuments()\n      body.id = `QRY${String(count + 1).padStart(3, '0')}`\n    }\n\n    body.createdBy = createdBy || 'Unknown'\n    body.createdAt = new Date().toISOString().split('T')[0]\n    body.responses = []\n    body.updatedAt = new Date()\n\n    const { role: _, centreId: __, createdBy: ___, ...queryData } = body\n    const result = await queriesCollection.insertOne(queryData)\n    \n    return NextResponse.json(\n      { success: true, data: { ...queryData, _id: result.insertedId } },\n      { status: 201 }\n    )\n  } catch (error) {\n    console.error('Error creating query:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to create query' },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT - Update query status (only super admin)\nexport async function PUT(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const queriesCollection = db.collection<Query>('queries')\n    \n    const body = await request.json()\n    const { id, status, role } = body\n\n    // Only super_admin can update query status\n    if (role !== 'super_admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized: Only super admin can update query status' },\n        { status: 403 }\n      )\n    }\n\n    const result = await queriesCollection.updateOne(\n      { id },\n      { \n        $set: { \n          status,\n          updatedAt: new Date()\n        }\n      }\n    )\n\n    if (result.matchedCount === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Query not found' },\n        { status: 404 }\n      )\n    }\n\n    const updatedQuery = await queriesCollection.findOne({ id })\n    \n    return NextResponse.json({ success: true, data: updatedQuery })\n  } catch (error) {\n    console.error('Error updating query:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to update query' },\n      { status: 500 }\n    )\n  }\n}\n\n// PATCH - Add response to query\nexport async function PATCH(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const queriesCollection = db.collection<Query>('queries')\n    \n    const body = await request.json()\n    const { queryId, message, respondedBy, role, centreId: userCentreId } = body\n\n    // Check if query exists\n    const query = await queriesCollection.findOne({ id: queryId })\n    if (!query) {\n      return NextResponse.json(\n        { success: false, error: 'Query not found' },\n        { status: 404 }\n      )\n    }\n\n    // Centre admin can only respond to queries from their centre\n    if (role === 'centre_admin' && query.centreId !== userCentreId) {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized: You can only respond to queries from your centre' },\n        { status: 403 }\n      )\n    }\n\n    // Generate response ID\n    const responseId = `RES${String(query.responses.length + 1).padStart(3, '0')}`\n    const newResponse = {\n      id: responseId,\n      message,\n      respondedBy,\n      respondedAt: new Date().toISOString().split('T')[0],\n      isAdmin: role === 'super_admin'\n    }\n\n    // Update status if super admin responds\n    const updateData: any = {\n      $push: { responses: newResponse },\n      $set: { updatedAt: new Date() }\n    }\n\n    if (role === 'super_admin') {\n      updateData.$set.status = 'in_progress'\n    }\n\n    const result = await queriesCollection.updateOne(\n      { id: queryId },\n      updateData\n    )\n\n    const updatedQuery = await queriesCollection.findOne({ id: queryId })\n    \n    return NextResponse.json({ success: true, data: updatedQuery })\n  } catch (error) {\n    console.error('Error adding response:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to add response' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}