{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\n\n// Default connection string if not in env (for scripts)\nconst defaultUri = 'mongodb+srv://necks:fdLaWizvRAmTYvdG@cluster0.ebmc6q3.mongodb.net/rehabilitation-centre-tracking?retryWrites=true&w=majority&appName=Cluster0'\n\nif (!process.env.MONGODB_URI && typeof window === 'undefined') {\n  // Only set default in server-side context\n  process.env.MONGODB_URI = defaultUri\n}\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Please add your Mongo URI to .env.local')\n}\n\nconst uri: string = process.env.MONGODB_URI\nconst options = {}\n\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === 'development') {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>\n  }\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    globalWithMongo._mongoClientPromise = client.connect()\n  }\n  clientPromise = globalWithMongo._mongoClientPromise\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\nexport default clientPromise\n\nexport async function getDatabase(): Promise<Db> {\n  const client = await clientPromise\n  return client.db('rehabilitation-centre-tracking')\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,wDAAwD;AACxD,MAAM,aAAa;AAEnB,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,IAAI,kDAAkB,aAAa;IAC7D,0CAA0C;IAC1C,QAAQ,GAAG,CAAC,WAAW,GAAG;AAC5B;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAc,QAAQ,GAAG,CAAC,WAAW;AAC3C,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAQe;AAER,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACnB"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/app/api/auth/forgot-password/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getDatabase } from '@/lib/mongodb'\nimport { User } from '@/lib/models'\nimport crypto from 'crypto'\nimport nodemailer from 'nodemailer'\nimport bcrypt from 'bcryptjs'\n\n// POST - Request password reset - sends new temporary password\nexport async function POST(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const usersCollection = db.collection<User>('users')\n    \n    const body = await request.json()\n    const { email } = body\n\n    if (!email) {\n      return NextResponse.json(\n        { success: false, error: 'Email is required' },\n        { status: 400 }\n      )\n    }\n\n    const user = await usersCollection.findOne({ email: email.toLowerCase() })\n    \n    if (!user) {\n      // User not found - return error\n      return NextResponse.json({\n        success: false,\n        error: 'No account found with this email address. Please check your email or register first.'\n      }, { status: 404 })\n    }\n\n    // Generate temporary password (8 characters: mix of letters and numbers)\n    const tempPassword = generateTemporaryPassword()\n    \n    // Hash the temporary password\n    const saltRounds = 10\n    const hashedPassword = await bcrypt.hash(tempPassword, saltRounds)\n\n    // Update user password with temporary password\n    await usersCollection.updateOne(\n      { id: user.id },\n      {\n        $set: {\n          password: hashedPassword,\n          updatedAt: new Date(),\n        }\n      }\n    )\n\n    // Send email with login credentials\n    try {\n      await sendCredentialsEmail(user.email, user.name, email.toLowerCase(), tempPassword)\n    } catch (emailError) {\n      console.error('Error sending email:', emailError)\n      // Still return success to not reveal email issues\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Login credentials have been sent to your email address.'\n    })\n  } catch (error) {\n    console.error('Error processing forgot password:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to process request. Please try again.' },\n      { status: 500 }\n    )\n  }\n}\n\nfunction generateTemporaryPassword(): string {\n  // Generate a secure temporary password: 8 characters with uppercase, lowercase, and numbers\n  const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n  const lowercase = 'abcdefghijklmnopqrstuvwxyz'\n  const numbers = '0123456789'\n  const allChars = uppercase + lowercase + numbers\n  \n  let password = ''\n  // Ensure at least one of each type\n  password += uppercase[Math.floor(Math.random() * uppercase.length)]\n  password += lowercase[Math.floor(Math.random() * lowercase.length)]\n  password += numbers[Math.floor(Math.random() * numbers.length)]\n  \n  // Fill the rest randomly\n  for (let i = password.length; i < 8; i++) {\n    password += allChars[Math.floor(Math.random() * allChars.length)]\n  }\n  \n  // Shuffle the password\n  return password.split('').sort(() => Math.random() - 0.5).join('')\n}\n\nasync function sendCredentialsEmail(email: string, name: string, loginEmail: string, tempPassword: string) {\n  // Configure email transporter\n  // For production, use environment variables for email credentials\n  const transporter = nodemailer.createTransport({\n    host: process.env.SMTP_HOST || 'smtp.gmail.com',\n    port: parseInt(process.env.SMTP_PORT || '587'),\n    secure: false, // true for 465, false for other ports\n    auth: {\n      user: process.env.SMTP_USER,\n      pass: process.env.SMTP_PASSWORD,\n    },\n  })\n\n  // If no SMTP credentials, log the credentials instead (for development)\n  if (!process.env.SMTP_USER || !process.env.SMTP_PASSWORD) {\n    console.log('=== LOGIN CREDENTIALS (Development Mode) ===')\n    console.log(`Email: ${email}`)\n    console.log(`Name: ${name}`)\n    console.log(`Login Email: ${loginEmail}`)\n    console.log(`Temporary Password: ${tempPassword}`)\n    console.log(`Login URL: ${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}`)\n    console.log('============================================')\n    return\n  }\n\n  const mailOptions = {\n    from: `\"NRCMS\" <${process.env.SMTP_USER}>`,\n    to: email,\n    subject: 'Your Login Credentials - NRCMS',\n    html: `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        </head>\n        <body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n          <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n            <div style=\"text-align: center; margin-bottom: 30px;\">\n              <h1 style=\"color: #1e3a8a;\">NRCMS</h1>\n              <p style=\"color: #666;\">National Rehabilitation Centre Management System</p>\n            </div>\n            \n            <div style=\"background: #f8f9fa; padding: 30px; border-radius: 8px;\">\n              <h2 style=\"color: #1e3a8a; margin-top: 0;\">Your Login Credentials</h2>\n              \n              <p>Hello ${name},</p>\n              \n              <p>You have requested to retrieve your login credentials for your NRCMS account.</p>\n              \n              <div style=\"background: white; padding: 20px; border-radius: 5px; border: 2px solid #1e3a8a; margin: 20px 0;\">\n                <h3 style=\"color: #1e3a8a; margin-top: 0;\">Your Login Details:</h3>\n                <table style=\"width: 100%; border-collapse: collapse;\">\n                  <tr>\n                    <td style=\"padding: 10px 0; font-weight: bold; color: #666;\">Email:</td>\n                    <td style=\"padding: 10px 0; color: #1e3a8a; font-size: 16px;\"><strong>${loginEmail}</strong></td>\n                  </tr>\n                  <tr>\n                    <td style=\"padding: 10px 0; font-weight: bold; color: #666;\">Password:</td>\n                    <td style=\"padding: 10px 0; color: #1e3a8a; font-size: 16px; font-family: monospace; letter-spacing: 2px;\"><strong>${tempPassword}</strong></td>\n                  </tr>\n                </table>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}\" \n                   style=\"background: #1e3a8a; color: white; padding: 12px 30px; \n                          text-decoration: none; border-radius: 5px; display: inline-block;\">\n                  Login Now\n                </a>\n              </div>\n              \n              <p style=\"font-size: 14px; color: #d32f2f; background: #ffebee; padding: 15px; border-radius: 5px; border-left: 4px solid #d32f2f;\">\n                <strong>⚠️ Security Notice:</strong><br>\n                • This is a temporary password. Please change it after logging in for security.<br>\n                • Keep your credentials secure and do not share them with anyone.<br>\n                • If you didn't request this, please contact support immediately.\n              </p>\n              \n              <p style=\"font-size: 14px; color: #666; margin-top: 20px;\">\n                <strong>Login URL:</strong><br>\n                <a href=\"${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}\" style=\"color: #1e3a8a; word-break: break-all;\">\n                  ${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}\n                </a>\n              </p>\n            </div>\n            \n            <div style=\"margin-top: 30px; text-align: center; font-size: 12px; color: #999;\">\n              <p>Government of India</p>\n              <p>This is an automated email. Please do not reply.</p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `,\n  }\n\n  await transporter.sendMail(mailOptions)\n}\n\n"],"names":[],"mappings":"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"}}]
}