{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from 'mongodb'\n\n// Default connection string if not in env (for scripts)\nconst defaultUri = 'mongodb+srv://necks:fdLaWizvRAmTYvdG@cluster0.ebmc6q3.mongodb.net/rehabilitation-centre-tracking?retryWrites=true&w=majority&appName=Cluster0'\n\nif (!process.env.MONGODB_URI && typeof window === 'undefined') {\n  // Only set default in server-side context\n  process.env.MONGODB_URI = defaultUri\n}\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Please add your Mongo URI to .env.local')\n}\n\nconst uri: string = process.env.MONGODB_URI\nconst options = {}\n\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === 'development') {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>\n  }\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    globalWithMongo._mongoClientPromise = client.connect()\n  }\n  clientPromise = globalWithMongo._mongoClientPromise\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\n// Export a module-scoped MongoClient promise. By doing this in a\n// separate module, the client can be shared across functions.\nexport default clientPromise\n\nexport async function getDatabase(): Promise<Db> {\n  const client = await clientPromise\n  return client.db('rehabilitation-centre-tracking')\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,wDAAwD;AACxD,MAAM,aAAa;AAEnB,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,IAAI,kDAAkB,aAAa;IAC7D,0CAA0C;IAC1C,QAAQ,GAAG,CAAC,WAAW,GAAG;AAC5B;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAc,QAAQ,GAAG,CAAC,WAAW;AAC3C,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAQe;AAER,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACnB"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///Users/tanishkmittal/Downloads/rehabilitation-centre-tracking/app/api/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getDatabase } from '@/lib/mongodb'\nimport { User } from '@/lib/models'\n\n// POST - Register a new centre admin\nexport async function POST(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const usersCollection = db.collection<User>('users')\n    \n    const body = await request.json()\n    const { email, name, phone, centreName, centreAddress, centreState, centreCity } = body\n\n    // Validate required fields\n    if (!email || !name || !phone || !centreName || !centreAddress || !centreState || !centreCity) {\n      return NextResponse.json(\n        { success: false, error: 'All fields are required' },\n        { status: 400 }\n      )\n    }\n\n    // Check if user already exists\n    const existingUser = await usersCollection.findOne({ email: email.toLowerCase() })\n    if (existingUser) {\n      return NextResponse.json(\n        { success: false, error: 'Email already registered' },\n        { status: 400 }\n      )\n    }\n\n    // Generate user ID\n    const count = await usersCollection.countDocuments()\n    const userId = `admin${String(count + 1).padStart(3, '0')}`\n\n    // Create pending user\n    const newUser: User = {\n      id: userId,\n      name,\n      email: email.toLowerCase(),\n      role: 'centre_admin',\n      centreId: null, // Will be assigned after approval\n      phone,\n      centreName,\n      centreAddress,\n      centreState,\n      centreCity,\n      status: 'pending',\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    }\n\n    const result = await usersCollection.insertOne(newUser)\n    \n    return NextResponse.json(\n      { \n        success: true, \n        message: 'Registration submitted successfully. Please wait for super admin approval.',\n        data: { ...newUser, _id: result.insertedId } \n      },\n      { status: 201 }\n    )\n  } catch (error) {\n    console.error('Error registering user:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to register. Please try again.' },\n      { status: 500 }\n    )\n  }\n}\n\n// GET - Get all pending registrations (super admin only)\nexport async function GET(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const usersCollection = db.collection<User>('users')\n    \n    const { searchParams } = new URL(request.url)\n    const status = searchParams.get('status') || 'pending'\n    const role = searchParams.get('role')\n\n    // Only super admin can view registrations\n    if (role !== 'super_admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized' },\n        { status: 403 }\n      )\n    }\n\n    const query: any = { status }\n    if (status === 'pending') {\n      query.role = 'centre_admin'\n    }\n\n    const registrations = await usersCollection\n      .find(query)\n      .sort({ createdAt: -1 })\n      .toArray()\n    \n    return NextResponse.json({ success: true, data: registrations })\n  } catch (error) {\n    console.error('Error fetching registrations:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch registrations' },\n      { status: 500 }\n    )\n  }\n}\n\n// PUT - Approve or reject registration (super admin only)\nexport async function PUT(request: NextRequest) {\n  try {\n    const db = await getDatabase()\n    const usersCollection = db.collection<User>('users')\n    const centresCollection = db.collection('centres')\n    \n    const body = await request.json()\n    const { userId, action, role, approvedBy, rejectionReason, centreId } = body\n\n    // Only super admin can approve/reject\n    if (role !== 'super_admin') {\n      return NextResponse.json(\n        { success: false, error: 'Unauthorized: Only super admin can approve registrations' },\n        { status: 403 }\n      )\n    }\n\n    const user = await usersCollection.findOne({ id: userId })\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    if (action === 'approve') {\n      // Create centre if not exists\n      let assignedCentreId = centreId\n      \n      if (!assignedCentreId) {\n        // Generate centre ID\n        const stateCode = user.centreState?.substring(0, 2).toUpperCase() || 'XX'\n        const centreCount = await centresCollection.countDocuments()\n        assignedCentreId = `C${stateCode}${String(centreCount + 1).padStart(3, '0')}`\n        \n        // Create centre\n        const newCentre = {\n          id: assignedCentreId,\n          name: user.centreName,\n          state: user.centreState,\n          city: user.centreCity,\n          address: user.centreAddress,\n          phone: user.phone || '',\n          email: user.email,\n          capacity: 100, // Default capacity\n          administrator: user.name,\n          adminEmail: user.email,\n          status: 'active',\n          createdAt: new Date().toISOString().split('T')[0],\n          updatedAt: new Date(),\n        }\n        \n        await centresCollection.insertOne(newCentre)\n      }\n\n      // Update user status\n      await usersCollection.updateOne(\n        { id: userId },\n        {\n          $set: {\n            status: 'approved',\n            centreId: assignedCentreId,\n            approvedAt: new Date(),\n            approvedBy,\n            updatedAt: new Date(),\n          }\n        }\n      )\n\n      return NextResponse.json({\n        success: true,\n        message: 'Registration approved successfully',\n        data: { centreId: assignedCentreId }\n      })\n    } else if (action === 'reject') {\n      // Update user status\n      await usersCollection.updateOne(\n        { id: userId },\n        {\n          $set: {\n            status: 'rejected',\n            rejectionReason: rejectionReason || 'Registration rejected by super admin',\n            approvedBy,\n            updatedAt: new Date(),\n          }\n        }\n      )\n\n      return NextResponse.json({\n        success: true,\n        message: 'Registration rejected'\n      })\n    } else {\n      return NextResponse.json(\n        { success: false, error: 'Invalid action' },\n        { status: 400 }\n      )\n    }\n  } catch (error) {\n    console.error('Error processing registration:', error)\n    return NextResponse.json(\n      { success: false, error: 'Failed to process registration' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}